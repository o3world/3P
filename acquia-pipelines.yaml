version: 1.0.0
variables:
  global:
    HOSTING_API_STAGE: canary
    SLACK_HOSTNAME: "3blmedia.slack.com"
    SLACK_TOKEN:
      secure: xoxp-3859056761-143991398354-448322414964-e56dd75b08dda497a21699927641d9ae
    SLACK_CHANNEL: "#release"
    SLACK_USERNAME: "scarroll"
events:
  build:
    steps:
      - build:
          script:
            - nvm install v6.11.1
            - nvm use 6.11.1
            - npm install
            - npm run build
      - upload-artifact:
          script:
            - pipelines-artifact start
            - pipelines-artifact upload $SOURCE_DIR
      - notify:
          type: script
          script:
            - curl -d '{"channel":"${SLACK_CHANNEL}", "username":"${SLACK_USERNAME}", "text":"Build Succeeded"}' -X POST https://${SLACK_HOSTNAME}/services/hooks/incoming-webhook?token=${SLACK_TOKEN}
  fail-on-build:
    steps:
      - fail:
          script:
            - pipelines-artifact fail
